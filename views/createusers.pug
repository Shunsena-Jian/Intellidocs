extends layout.pug

block body
    script(src='https://code.jquery.com/jquery-3.6.4.min.js')

    script.
        $(document).ready(function(){
            $('#userLevel').change(function(){
                var selectedLevel = $(this).val();
                if (selectedLevel === 'Document Controller' || selectedLevel === 'Dean' || selectedLevel === 'Admin' || selectedLevel === 'Secretary') {
                    $('#userDepartment').parent().hide();
                } else {
                    $('#userDepartment').parent().show();
                }
            });
        });

    #main.w3-main(style='margin-left:250px')
        .w3-row.w3-padding-64
            .w3-container2.w3-card.w3-white.w3-round.w3-margin
                .form_container
                    form(name='form' role='form' method='POST' id='createUser')
                        h3.w3-bold.w3-margin CREATE A USER
                        .form_wrap.fullname
                            .form_item
                                label(style='font-family: Courier New, monospace; font-weight:normal;') Email
                                input#email.error(type='text' name='email' required='')
                            .form_item
                                label(style='font-family:Courier New, monospace;; font-weight:normal;') Password
                                input#passWord.error(type='text' name='passWord' required='')
                        .form_wrap.fullname
                            .form_item
                                label(style='font-family: Courier New, monospace;; font-weight:normal;') First Name
                                input#firstName.error(type='text' name='firstName' required='')
                            .form_item
                                label(style='font-family: Courier New, monospace;; font-weight:normal;') Last Name
                                input#lastName.error(type='text' name='lastName' required='')
                        .form_wrap.fullname
                            .form_item
                                label(style='font-family:Courier New, monospace;; font-weight:normal;') ID Number
                                input#empId.error(type='text' name='empId' required='')
                        .form_wrap.fullname
                            .form_item
                                label(for='userLevel' style='font-family: Courier New, monospace;; font-weight:normal;') User Level:
                                select#userLevel(name='userLevel' required='')
                                    option(value='null') Choose Role
                                    option(value='Document Controller') Document Controller
                                    option(value='Department Head') Department Head
                                    option(value='Faculty') Faculty
                                    option(value='Dean') Dean
                                    option(value='Admin') Admin
                                    option(value='Secretary') Secretary
                            .form_item
                                label(for='userDepartment' style='font-family: Courier New, monospace;; font-weight:normal;') User Department:
                                select#userDepartment(name='userDepartment' required='')
                                    option(value='null') Choose Department
                                    option(value='Information Technology') Information Technology
                                    option(value='Computer Science') Computer Science
                                    option(value='Multimedia Arts') Multimedia Arts
                        .btnPosition
                              button(class='btn' type='submit') Register

    script.
        $(document).ready(function () {
            $('#createUser').submit(function (event) {

                var data = {
                    email: document.getElementById('email').value,
                    passWord: document.getElementById('passWord').value,
                    firstName: document.getElementById('firstName').value,
                    lastName: document.getElementById('lastName').value,
                    empId: document.getElementById('empId').value,
                    userLevel: document.getElementById('userLevel').value,
                    userDepartment: document.getElementById('userDepartment').value
                };

                $.ajax({
                    type: 'POST',
                    url: '/createusers',
                    data: data,
                    success: function(response) {
                        if(response.status_code === 1) {
                            alert("User Email already exists!");
                        } else if(response.status_code === 2) {
                            alert("User Employee ID already exists!");
                        } else if(response.status_code === 0) {
                            alert("User successfully created!");
                            location.reload();
                        } else if(response.status_code === 3) {
                            alert("Employee must have a Department");
                        }
                    },
                    error: function (error) {
                        console.error('AJAX error:', error);
                    }
                });

                // Prevent the default form submission
                event.preventDefault();
            });
        });


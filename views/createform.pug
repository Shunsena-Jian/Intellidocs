extends layout.pug

block body
    .w3-main#main(style='margin-left:230px; margin-top:50px; margin-bottom:50px; margin-right:30px;')
        .w3-row.w3-container
            .w3-row.w3-container.w3-card
                h4.w3-bold Create Form
                .w3-row.w3-container
                    .w3-half
                        input#formName.w3-row.w3-input.w3-margin(placeholder="Type Form Name [Required]" type='text' name='formName' required='')
                        input#formControlNumber.w3-row.w3-input.w3-margin(placeholder="Type Form Control Number [Required]" type='text' name='formControlNumber' required='')
                    .w3-half
                        .w3-third.w3-right
                            br
                            br
                            br
                            button.w3-button.w3-bold.w3-blue-classic(onclick='saveForm()')
                                | Save Form
            br
            .w3-row.w3-card
                .grid-container.w3-light-grey.w3-padding-16
                    .grid-item
                        label(for='createPageMargin') Page Margin:
                        select#createPageMargin(onchange='createPageMargin()')
                            option(value='narrow') Narrow
                            option(value='normal') Normal
                            option(value='moderate') Moderate
                    .grid-item
                        label(for='modifyOrientation') Orientation:
                        select#modifyOrientation(onchange='modifyOrientation()')
                            option(value='portrait') Portrait
                            option(value='landscape') Landscape
                    .grid-item.borderless
                    .grid-item
                        label(for='colorSelect') Select Text Color:
                        select#colorSelect(onchange='changeTextColor()')
                            option(value='black') Black
                            option(value='white') White
                            option(value='red') Red
                            option(value='blue') Blue
                            option(value='grey') Grey

                    .grid-item.borderless
                    .grid-item
                        a.w3-bar-item.w3-button.w3-hide-small.w3-hover-white(onclick='makeItalic()')
                            i.fa.fa-italic.icon-light
                    .grid-item
                        a.w3-bar-item.w3-button.w3-hide-small.w3-hover-white(onclick='makeBold()')
                            i.fa.fa-bold.icon-light
                    .grid-item
                        a.w3-bar-item.w3-button.w3-hide-small.w3-hover-white(onclick='makeUnderline()')
                            i.fa.fa-underline.icon-light
                    .grid-item.borderless
                    .grid-item
                        a.w3-bar-item.w3-button.w3-hide-small.w3-hover-white(onclick='makeAlignLeft()')
                            i.fa.fa-align-left.icon-light
                    .grid-item
                        a.w3-bar-item.w3-button.w3-hide-small.w3-hover-white(onclick='makeAlignCenter()')
                            i.fa.fa-align-center.icon-light
                    .grid-item
                        a.w3-bar-item.w3-button.w3-hide-small.w3-hover-white(onclick='makeAlignRight()')
                            i.fa.fa-align-right.icon-light
                    .grid-item
                        a.w3-bar-item.w3-button.w3-hide-small.w3-hover-white(onclick='makeAlignJustify()')
                            i.fa.fa-align-justify.icon-light
                    .grid-item.borderless

            .w3-row.w3-container
                .w3-twothird.w3-container
                    .paperContainer
                        #form-content.pages
                            #page-1.drop-container

                .w3-third
                    .page-container.w3-container.w3-light-grey
                        include dragbar

    script(src='js/client.engine/htmlToJson.js')
    script.
        function saveForm() {
            //var formBody = document.getElementById('form-content').innerHTML;
            var formBody = document.getElementById('form-content');
            var formName = document.getElementById('formName').value;
            var formControlNumber = document.getElementById('formControlNumber').value;

            var inputFieldValuesJSON = [];
            formBody = elementToJson(formBody,inputFieldValuesJSON);

            getNewKeyID(formBody);

            if (formBody === null || formBody === "" || formName === null || formName === "" || formControlNumber === null || formControlNumber === "") {
                alert("Form Body, Form Name, or Form Control Number is empty!");
            } else {
                const data = {
                    name: formName,
                    formControlNumber: formControlNumber,
                    formContent: formBody,
                    formStatus: "Template"
                };

                $.ajax({
                    type: 'POST',
                    url: '/savecreatedform',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function (data) {
                        if (data.success) {
                            window.location.href = '/';
                        } else if (data.status_code === 1) {
                            alert("Form name already exists. Proceed to view form templates to edit the form instead!");
                        } else {
                            alert("Error in AJAX function.");
                        }
                    },
                    error: function (error) {
                        console.error('AJAX error:', error);
                    }
                });
            }
        }


    script.
        // Not working, to be debugged
        function restrictCheckBoxSelection() {
        const checkboxes = document.querySelectorAll('input[name="academicStatus"]');
        console.log(checkboxes);
            console
          // Add a change event listener to each checkbox
                    checkboxes.forEach((checkbox) => {
                        checkbox.addEventListener('change', function () {
                            // Uncheck all other checkboxes in the group
                            checkboxes.forEach((otherCheckbox) => {
                                if (otherCheckbox !== this) {
                                    otherCheckbox.checked = false;
                                }
                            });
                        });
                    });
        }

        restrictCheckBoxSelection();



    link(rel='stylesheet' href='hnodettps://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css')
    link(rel='stylesheet' href='../css/w3css4.css')
    link(rel='stylesheet' href='../css/w3-theme.css')
    link(rel='stylesheet' href='../css/text_editor.css')
    link(rel='stylesheet' href='../css/create_form_style.css')

    script(src='https://code.jquery.com/jquery-1.12.4.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.3/jspdf.min.js')
    script(src='https://html2canvas.hertzen.com/dist/html2canvas.js')
    script(src='js/client.form/form_create_view_edit.js')

